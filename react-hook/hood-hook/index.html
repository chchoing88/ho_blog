<!DOCTYPE html><html><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><link rel="preload" href="/ho_blog/component---src-layouts-index-js-60e98b905b7a1c56256e.js" as="script"/><link rel="preload" href="/ho_blog/component---src-templates-blog-post-js-ebc7dbd570985ea11c85.js" as="script"/><link rel="preload" href="/ho_blog/path---react-hook-hood-hook-75a9cdff94a7a74ac6a2.js" as="script"/><link rel="preload" href="/ho_blog/app-908537d1c1604367fc7c.js" as="script"/><link rel="preload" href="/ho_blog/commons-7ef76ddc28e0e340bbc7.js" as="script"/><style id="glamor-styles"></style><script id="glamor-ids">
        // <![CDATA[
        window._glamor = []
        // ]]>
        </script><link rel="alternate" type="application/rss+xml" href="/ho_blog/rss.xml"/><title data-react-helmet="true">Under the hood of React Hooks | Merlin Tec Blog</title><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:106.25%/1.53 'Source Sans Pro',sans-serif;box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Source Sans Pro',sans-serif;font-weight:400;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;color:inherit;font-family:'Merriweather',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:2rem;line-height:2.295rem;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;color:inherit;font-family:'Merriweather',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:2.295rem;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;color:inherit;font-family:'Merriweather',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1.1487rem;line-height:1.53rem;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;color:inherit;font-family:'Merriweather',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.53rem;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;color:inherit;font-family:'Merriweather',serif;font-weight:700;text-rendering:optimizeLegibility;font-size:0.917rem;line-height:1.53rem;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;color:inherit;font-family:Source Sans Pro,sans-serif;font-weight:400;text-rendering:optimizeLegibility;font-size:0.8409rem;line-height:1.53rem;text-transform:uppercase;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}ul{margin-left:1.53rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.53rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;font-size:0.85rem;line-height:1.42;background:hsla(0,0%,0%,0.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.53rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;font-size:1rem;line-height:1.53rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}blockquote{margin-left:1.53rem;margin-right:1.53rem;margin-top:0;padding-bottom:0.51rem;padding-left:1.02rem;padding-right:1.02rem;padding-top:0.51rem;margin-bottom:1.53rem;font-size:1.18921rem;line-height:1.53rem;border-left:0.255rem solid;border-color:hsla(0,0%,0%,0.07);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.53rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.53rem;}b{font-weight:700;}strong{font-weight:700;}dt{font-weight:700;}th{font-weight:700;}li{margin-bottom:calc(1.53rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.53rem;margin-bottom:calc(1.53rem / 2);margin-top:calc(1.53rem / 2);}li > ul{margin-left:1.53rem;margin-bottom:calc(1.53rem / 2);margin-top:calc(1.53rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.53rem / 2);}code{font-size:0.85rem;line-height:1.53rem;}kbd{font-size:0.85rem;line-height:1.53rem;}samp{font-size:0.85rem;line-height:1.53rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.02rem;padding-right:1.02rem;padding-top:0.765rem;padding-bottom:calc(0.765rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}tt,code{background-color:hsla(0,0%,0%,0.04);border-radius:3px;font-family:"SFMono-Regular", Consolas,"Roboto Mono","Droid Sans Mono","Liberation Mono",Menlo,Courier,monospace;padding:0;padding-top:0.2em;padding-bottom:0.2em;}pre code{background:none;line-height:1.42;}code:before,code:after,tt:before,tt:after{letter-spacing:-0.2em;content:" ";}pre code:before,pre code:after,pre tt:before,pre tt:after{content:none;}a{color:#0071bc;text-decoration:none;}a:visited{color:#4c2c92;}blockquote > :last-child{margin-bottom:0;}blockquote cite{font-size:1rem;line-height:1.53rem;color:hsla(204,5.275997423999999%,0%,0.46);font-weight:400;font-style:normal;}div.gatsby-highlight{margin-bottom:20px;}</style><link href="//fonts.googleapis.com/css?family=Merriweather:700|Source+Sans+Pro:400,400i,700" rel="stylesheet" type="text/css"/><style id="gatsby-inlined-css">.editor .wrap-guide{background:hsla(0,0%,100%,.1)}.editor .indent-guide{color:hsla(0,0%,100%,.15)}.editor,.editor .gutter{background-color:#282828;color:#f8f8f2}.editor.is-focused .cursor{border-color:#f8f8f0}.editor.is-focused .line-number.cursor-line-no-selection,.editor.is-focused .selection .region{background-color:#49483e}.editor .invisible-character{color:hsla(0,0%,84%,.15)}.editor .comment{color:#75715e}.editor .string{color:#e6db74}.editor .constant.character,.editor .constant.language,.editor .constant.numeric,.editor .constant.other{color:#ae81ff}.editor .keyword,.editor .storage{color:#f92672}.editor .storage.type{font-style:italic;color:#66d9ef}.editor .entity.name.class,.editor .entity.other.inherited-class{text-decoration:underline;color:#a6e22e}.editor .entity.other.inherited-class{font-style:italic}.editor .entity.name.function{color:#a6e22e}.editor .entity.name.instance{color:#66d9ef}.editor .variable.parameter{font-style:italic;color:#fd971f}.editor .entity.name.tag{color:#f92672}.editor .entity.other.attribute-name{color:#a6e22e}.editor .support.constant,.editor .support.function{color:#66d9ef}.editor .support.class,.editor .support.type{font-style:italic;color:#66d9ef}.editor .invalid{color:#f8f8f0;background-color:#f92672}.editor .invalid.deprecated{color:#f8f8f0;background-color:#ae81ff}.editor .class.jade{color:#ae81ff}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/ho_blog/static/montserrat-latin-100.50d27986.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-100.5e334eff.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/ho_blog/static/montserrat-latin-100italic.8c070533.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-100italic.03e19243.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/ho_blog/static/montserrat-latin-200.4343d3d9.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-200.f2022ecd.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/ho_blog/static/montserrat-latin-200italic.116c4c4b.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-200italic.89614a60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/ho_blog/static/montserrat-latin-300.d2ad295b.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-300.3a371ee0.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/ho_blog/static/montserrat-latin-300italic.f6b6bf24.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-300italic.16521668.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/ho_blog/static/montserrat-latin-400.240a8444.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-400.b20cc131.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/ho_blog/static/montserrat-latin-400italic.86172bb8.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-400italic.9405e787.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/ho_blog/static/montserrat-latin-500.fb8d6b71.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-500.50825d47.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/ho_blog/static/montserrat-latin-500italic.c0a555a4.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-500italic.635de59c.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/ho_blog/static/montserrat-latin-600.d5615136.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-600.f300da4f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/ho_blog/static/montserrat-latin-600italic.10f29d13.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-600italic.2bc37d86.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/ho_blog/static/montserrat-latin-700.7d77e1f0.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-700.81826529.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/ho_blog/static/montserrat-latin-700italic.1dd2b53f.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-700italic.c162d257.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/ho_blog/static/montserrat-latin-800.d4e7bf86.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-800.895aadbf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/ho_blog/static/montserrat-latin-800italic.fc0cbe44.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-800italic.b3362875.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/ho_blog/static/montserrat-latin-900.c8bdd772.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-900.1b99ef78.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/ho_blog/static/montserrat-latin-900italic.cb72c1f9.woff2) format("woff2"),url(/ho_blog/static/montserrat-latin-900italic.b78bb9f8.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/ho_blog/static/merriweather-latin-300.f015f1e9.woff2) format("woff2"),url(/ho_blog/static/merriweather-latin-300.92dfe81b.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/ho_blog/static/merriweather-latin-300italic.7fd86b32.woff2) format("woff2"),url(/ho_blog/static/merriweather-latin-300italic.878b76f5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/ho_blog/static/merriweather-latin-400.12dbf4c0.woff2) format("woff2"),url(/ho_blog/static/merriweather-latin-400.1fffad22.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/ho_blog/static/merriweather-latin-400italic.1e0d3e81.woff2) format("woff2"),url(/ho_blog/static/merriweather-latin-400italic.de18d4c4.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/ho_blog/static/merriweather-latin-700.dc8fec81.woff2) format("woff2"),url(/ho_blog/static/merriweather-latin-700.d7d2ed8e.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/ho_blog/static/merriweather-latin-700italic.b7b7e5da.woff2) format("woff2"),url(/ho_blog/static/merriweather-latin-700italic.6210a5fc.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/ho_blog/static/merriweather-latin-900.43f870d5.woff2) format("woff2"),url(/ho_blog/static/merriweather-latin-900.8f3806df.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/ho_blog/static/merriweather-latin-900italic.168c1ab2.woff2) format("woff2"),url(/ho_blog/static/merriweather-latin-900italic.ae7778f0.woff) format("woff")}</style></head><body><div id="___gatsby"><div style="max-width:52.02rem;margin-left:auto;margin-right:auto;padding:2.295rem 1.1475rem;" data-reactroot="" data-reactid="1" data-react-checksum="-2108075300"><h3 style="font-family:Montserrat, sans-serif;margin-top:0;" data-reactid="2"><a style="box-shadow:none;text-decoration:none;color:inherit;" href="/ho_blog/" data-reactid="3">Merlin Tec Blog</a></h3><div data-reactid="4"><!-- react-empty: 5 --><h1 data-reactid="6">Under the hood of React Hooks</h1><p style="font-size:0.87055rem;line-height:1.53rem;display:block;margin-bottom:1.53rem;margin-top:-1.53rem;" data-reactid="7">July 30, 2019</p><div data-reactid="8"><p><a href="https://medium.com/the-guild/under-the-hood-of-reacts-hooks-system-eb59638c9dba">이글</a>을 번역 및 분석 한 글입니다. 잘못된 번역이 있을 수 있습니다. 또한 예전 코드들이 많으므로 참고만 해야 합니다. 현재 코드랑 다른점이 많이 있습니다.</p>
<h1>Under the hood of React’s hooks system</h1>
<p>우리는 모두 그것에 대해 들었습니다. React 16.7 의 새로운 훅 시스템은 커뮤니티에서 많은 이야기가 나옵니다. 우리는 모두 그것을 시도하고 그것을 테스트하고, 그리고 그것의 잠재력에 대해 정말로 흥분했습니다. 후크에 대해 생각할 때 그것들은 다소 마술적입니다. 어떻게 든 React 는 인스턴스를 노출하지 않고도이 구성 요소를 관리합니다 (<code>this</code> 키워드를 사용하지 않아도 됨). 그래서 도대체 어떻게 React 가 그렇게합니까?</p>
<p>오늘 나는 React 의 후크 구현에 대해 더 자세히 이해할 수 있기를 바랍니다. 마법 같은 기능의 문제점은 복잡한 스택 추적으로 뒷받침되기 때문에 문제가 발생하면 문제를 디버그하는 것이 더 어렵다는 것입니다. 따라서, React 의 새로운 후크 시스템에 대한 깊은 지식을 갖게되면 문제가 발생하면 이를 신속하게 해결할 수 있을 것입니다.</p>
<blockquote>
<p>시작하기 전에 저는 제가 React 의 개발자 / 유지자가 아니며 제 말을 아주 작은 알갱이로 가야한다고 말하고 싶습니다. 나는 React ‘s hooks 시스템의 구현에 깊이 깊이 잠긴했지만, 꼭 이것이 React 가 실제로 어떻게 작동 하는지를 보장 할 수는 없습니다. 필자는 필자의 말을 React 의 소스 코드에서 증명과 참조로 뒷받침했으며 가능한 한 견고하게 주장하려고 노력했습니다.</p>
</blockquote>
<p><img src="https://miro.medium.com/max/684/1*R-oovJm4IQBLDjZy6DvbBg.png" alt="https://miro.medium.com/max/684/1*R-oovJm4IQBLDjZy6DvbBg.png"></p>
<p>우선, 올바른 컨텍스트에서 호출되지 않으면 후크가 의미가 없다는 것을 알았을 것이므로 React의 범위 내에서 후크가 호출되도록하는 메커니즘을 살펴 보겠습니다.</p>
<h2>The dispatcher</h2>
<p>디스패처는 후크 기능을 포함하는 공유 객체입니다. ReactDOM 의 렌더링 단계를 기반으로 동적으로 할당되거나 정리되며 사용자가 React 구성 요소 외부의 후크에 접근하지 못하게 합니다. (see <a href="https://github.com/facebook/react/tree/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactFiberDispatcher.js?source=post_page---------------------------#L24">implementation</a>).</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;ReactFiberDispatcher.js</span></span></span></div><div class="line"><span class="source js"><span class="meta import js"><span class="keyword control js"><span>import</span></span><span>&nbsp;</span><span class="punctuation definition modules begin js"><span>{</span></span></span></span></div><div class="line"><span class="source js"><span class="meta import js"><span>&nbsp;&nbsp;</span><span class="variable other module js"><span>useCallback</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></div><div class="line"><span class="source js"><span class="meta import js"><span>&nbsp;&nbsp;</span><span class="variable other module js"><span>useContext</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></div><div class="line"><span class="source js"><span class="meta import js"><span>&nbsp;&nbsp;</span><span class="variable other module js"><span>useEffect</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></div><div class="line"><span class="source js"><span class="meta import js"><span>&nbsp;&nbsp;</span><span class="variable other module js"><span>useImperativeMethods</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></div><div class="line"><span class="source js"><span class="meta import js"><span>&nbsp;&nbsp;</span><span class="variable other module js"><span>useLayoutEffect</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></div><div class="line"><span class="source js"><span class="meta import js"><span>&nbsp;&nbsp;</span><span class="variable other module js"><span>useMemo</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></div><div class="line"><span class="source js"><span class="meta import js"><span>&nbsp;&nbsp;</span><span class="variable other module js"><span>useMutationEffect</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></div><div class="line"><span class="source js"><span class="meta import js"><span>&nbsp;&nbsp;</span><span class="variable other module js"><span>useReducer</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></div><div class="line"><span class="source js"><span class="meta import js"><span>&nbsp;&nbsp;</span><span class="variable other module js"><span>useRef</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></div><div class="line"><span class="source js"><span class="meta import js"><span>&nbsp;&nbsp;</span><span class="variable other module js"><span>useState</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></div><div class="line"><span class="source js"><span class="meta import js"><span class="punctuation definition modules end js"><span>}</span></span><span>&nbsp;</span><span class="keyword control js"><span>from</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>./ReactFiberHooks</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta export js"><span class="keyword control js"><span>export</span></span><span>&nbsp;</span></span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>Dispatcher</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;readContext</span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;useCallback</span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;useContext</span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;useEffect</span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;useImperativeMethods</span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;useLayoutEffect</span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;useMemo</span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;useMutationEffect</span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;useReducer</span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;useRef</span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;useState</span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></pre>
<p>후크는 올바른 디스패처로 간단하게 전환하여 루트 구성 요소를 렌더링하기 전에 <code>enableHooks</code> 플래그에 의해 활성화 / 비활성화됩니다. 이는 기술적으로 런타임에 후크를 활성화 / 비활성화 할 수 있음을 의미합니다. React 16.6.X 에는 실험 기능이 구현되어 있지만 실제로는 사용할 수 없습니다. (see <a href="https://github.com/facebook/react/tree/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactFiberScheduler.js?source=post_page---------------------------#L1211">implementation</a>).</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;1211줄&nbsp;ReactFiberScheduler.js</span></span></span></div><div class="line"><span class="source js"><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span>enableHooks</span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="variable other object js"><span>ReactCurrentOwner</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>currentDispatcher</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;Dispatcher</span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span><span>&nbsp;</span><span class="keyword control js"><span>else</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="variable other object js"><span>ReactCurrentOwner</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>currentDispatcher</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;DispatcherWithoutHooks</span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></pre>
<p>렌더링 작업(여기서 렌더링 작업이라 하면 fiber를 구성하고 아직 스크린에 반영하지 않은 작업상태를 뜻한다.)이 끝나면 디스패처를 무효화하여 ReactDOM 렌더링주기 밖에서 후크가 실수로 사용되는 것을 방지합니다. 이것은 사용자가 어리석은 일을 하지 않도록 보장하는 메커니즘입니다. (see <a href="https://github.com/facebook/react/tree/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactFiberScheduler.js?source=post_page---------------------------#L1376">implementation</a>).</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;1376줄&nbsp;ReactFiberScheduler.js</span></span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;We&#39;re&nbsp;done&nbsp;performing&nbsp;work.&nbsp;Time&nbsp;to&nbsp;clean&nbsp;up.</span></span></span></div><div class="line"><span class="source js"><span class="variable other object js"><span>ReactCurrentOwner</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>currentDispatcher</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span></span></div></pre>
<p>dispatcher는 <code>resolveDispatcher()</code> 함수를 사용하여 각각의 모든 후크 호출에서 resolve됩니다. 앞에서 말했듯이, React 의 렌더링주기 밖에서는 의미가 없어야하고, React 는 경고 메시지를 출력해야합니다 : <em>“후크는 함수 구성 요소의 본체 내부에서만 호출 할 수 있습니다”</em> (see <a href="https://github.com/facebook/react/tree/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react/src/ReactHooks.js?source=post_page---------------------------#L17">implementation</a>).</p>
<p>Dispatcher 실행을 간단하게 표현하면 아래와 같습니다.</p>
<p>매 <code>renderRoot</code> 에서만 <code>currentDispatcher</code> 가 할당되며 render가 모두 끝나면 <code>currentDispatcher</code> 을 null 처리 해서 외부 에서 <code>useXXX</code>를 호출 했을시 error 가 나게 했다.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="storage type var js"><span>let</span></span><span>&nbsp;currentDispatcher</span></span></div><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>dispatcherWithoutHooks</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment block js"><span class="punctuation definition comment js"><span>/*</span></span><span>&nbsp;...&nbsp;</span><span class="punctuation definition comment js"><span>*/</span></span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>dispatcherWithHooks</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment block js"><span class="punctuation definition comment js"><span>/*</span></span><span>&nbsp;...&nbsp;</span><span class="punctuation definition comment js"><span>*/</span></span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>resolveDispatcher</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span><span>&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;적절한&nbsp;dispatcher를&nbsp;리턴해준다.</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span>currentDispatcher</span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;currentDispatcher</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>throw</span></span><span>&nbsp;</span><span class="support class js"><span>Error</span></span><span class="meta brace round js"><span>(</span></span><span class="string quoted double js"><span class="punctuation definition string begin js"><span>&quot;</span></span><span>Hooks&nbsp;can&#39;t&nbsp;be&nbsp;called</span><span class="punctuation definition string end js"><span>&quot;</span></span></span><span class="meta brace round js"><span>)</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>useXXX</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="keyword operator spread js"><span>...</span></span><span class="variable parameter rest function js"><span>args</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>dispatcher</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>resolveDispatcher</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="variable other object js"><span>dispatcher</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>useXXX</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="keyword operator spread js"><span>...</span></span><span>args</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>renderRoot</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;currentDispatcher&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;enableHooks&nbsp;</span><span class="keyword operator ternary js"><span>?</span></span><span>&nbsp;</span><span>dispatcherWithHooks</span><span>&nbsp;</span><span class="keyword operator ternary js"><span>:</span></span><span>&nbsp;dispatcherWithoutHooks&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;root&nbsp;render하기&nbsp;전에&nbsp;알맞는&nbsp;dispatcher&nbsp;셋팅</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>performWork</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;currentDispatcher&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></pre>
<p>실제 React github 코드 상에선 아래와 같이 표현하고 있다. (예전 코드)</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;16줄&nbsp;ReactFiberScheduler.js</span></span></span></div><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>resolveDispatcher</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>dispatcher</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>ReactCurrentOwner</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>currentDispatcher</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>invariant</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;dispatcher&nbsp;</span><span class="keyword operator comparison js"><span>!==</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>Hooks&nbsp;can&nbsp;only&nbsp;be&nbsp;called&nbsp;inside&nbsp;the&nbsp;body&nbsp;of&nbsp;a&nbsp;function&nbsp;component.</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;dispatcher</span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></pre>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;54줄&nbsp;ReactFiberScheduler.js</span></span></span></div><div class="line"><span class="source js"><span class="meta export js"><span class="keyword control js"><span>export</span></span><span>&nbsp;</span></span><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;useState&lt;S&gt;</span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>initialState</span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span class="meta function arrow js"><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="constant other js"><span>S</span></span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="keyword operator bitwise js"><span>|</span></span><span>&nbsp;</span><span class="constant other js"><span>S</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>dispatcher</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>resolveDispatcher</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="variable other object js"><span>dispatcher</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>useState</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>initialState</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></pre>
<p>이제는 간단한 <code>캡슐화 메커니즘</code>을 살펴 보았으므로 이 기사의 핵심 인 후크로 넘어 가고자 한다. 여기서 나는 새로운 개념을 소개하고자 합니다.</p>
<h2>The hooks queue</h2>
<p>React 뒤에서, hooks는 호출 순서로 함께 연결된 노드로 표시됩니다. 후크는 단순히 생성된 다음 혼자 남겨지는 것이 아니기 때문에 그렇게 표현됩니다. 그들은 그들이 있는 그대로가 될 수 있도록 하는 메커니즘을 가지고 있다. 후크(hook)에는 구현에 뛰어 들기 전에 염두해야 할 필요한 몇 가지 프로퍼티들 있습니다.</p>
<ul>
<li>hook의 초기 상태값은 초기 렌더링시에 생성됩니다.</li>
<li>hook의 상태는 즉시 업데이트 할 수 있습니다.</li>
<li>React 는 다음번 렌더링에서 hook 의 상태를 기억할 것입니다.</li>
<li>React 는 호출 순서에 따라 올바른 상태를 제공합니다.</li>
<li>React 는 이 hook 이 어떤 fiber 에 속하는지 알 수 있습니다.</li>
</ul>
<p>따라서 component 의 상태를 보는 방식을 다시 생각 해야합니다. 지금까지 우리는 마치 평범한 object 인 것처럼 그것에 대해 생각해 왔습니다.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;React&nbsp;state&nbsp;-&nbsp;the&nbsp;old&nbsp;way</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;foo</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>foo</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;bar</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>bar</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;baz</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>baz</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></pre>
<p>그러나 후크를 처리 할 때 각 노드가 하나의 상태 모델을 나타내는 큐로 간주 되어야합니다.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;React&nbsp;state&nbsp;-&nbsp;the&nbsp;new&nbsp;way</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;memoizedState</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>foo</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;baseUpdate</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;expirationTime</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>만료시간</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;action</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>업뎃에&nbsp;필요한&nbsp;액션</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;next</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>다음&nbsp;업뎃?</span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;queue</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;last</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>마지막에&nbsp;업데이트&nbsp;했던&nbsp;작업</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;dispatch</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span class="punctuation definition string end js"><span>&#39;</span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;next</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;memoizedState</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>bar</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;next</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memoizedState</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>baz</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;이것은&nbsp;흡사&nbsp;배열과&nbsp;비슷할&nbsp;수&nbsp;있을거&nbsp;같다.</span></span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;[&#39;foo&#39;,&nbsp;&#39;bar&#39;,&nbsp;&#39;baz&#39;]&nbsp;iterator</span></span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;[&#39;foo&#39;,&nbsp;&#39;bar&#39;,&nbsp;&#39;baz&#39;][Symbol.iterator]()</span></span></span></div></pre>
<p>단일 훅 노드의 스키마는 <a href="https://github.com/facebook/react/tree/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactFiberHooks.js?source=post_page---------------------------#L243">implementation</a>.에서 볼 수 있습니다.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span>type&nbsp;Update</span><span class="keyword operator comparison js"><span>&lt;</span></span><span class="constant other js"><span>A</span></span><span class="keyword operator comparison js"><span>&gt;</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;expirationTime</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;ExpirationTime</span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;action</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant other js"><span>A</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;next</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;Update</span><span class="keyword operator comparison js"><span>&lt;</span></span><span class="constant other js"><span>A</span></span><span class="keyword operator comparison js"><span>&gt;</span></span><span>&nbsp;</span><span class="keyword operator bitwise js"><span>|</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>type&nbsp;UpdateQueue</span><span class="keyword operator comparison js"><span>&lt;</span></span><span class="constant other js"><span>A</span></span><span class="keyword operator comparison js"><span>&gt;</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;last</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;Update</span><span class="keyword operator comparison js"><span>&lt;</span></span><span class="constant other js"><span>A</span></span><span class="keyword operator comparison js"><span>&gt;</span></span><span>&nbsp;</span><span class="keyword operator bitwise js"><span>|</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;dispatch</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;any</span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta export js"><span class="keyword control js"><span>export</span></span><span>&nbsp;</span><span class="variable other module js"><span>type</span></span><span>&nbsp;</span><span class="variable other module js"><span>Hook</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="punctuation definition modules begin js"><span>{</span></span></span></span></div><div class="line"><span class="source js"><span class="meta export js"><span>&nbsp;&nbsp;</span><span class="variable other module js"><span>memoizedState</span></span><span>:&nbsp;</span><span class="variable other module js"><span>any</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></div><div class="line"><span class="source js"><span class="meta export js"><span>&nbsp;</span></span></span></div><div class="line"><span class="source js"><span class="meta export js"><span>&nbsp;&nbsp;</span><span class="variable other module js"><span>baseState</span></span><span>:&nbsp;</span><span class="variable other module js"><span>any</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></div><div class="line"><span class="source js"><span class="meta export js"><span>&nbsp;&nbsp;</span><span class="variable other module js"><span>baseUpdate</span></span><span>:&nbsp;</span><span class="variable other module js"><span>Update</span></span><span>&lt;</span><span class="variable other module js"><span>any</span></span><span>&gt;&nbsp;|&nbsp;</span><span class="variable other module js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></div><div class="line"><span class="source js"><span class="meta export js"><span>&nbsp;&nbsp;</span><span class="variable other module js"><span>queue</span></span><span>:&nbsp;</span><span class="variable other module js"><span>UpdateQueue</span></span><span>&lt;</span><span class="variable other module js"><span>any</span></span><span>&gt;&nbsp;|&nbsp;</span><span class="variable other module js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></div><div class="line"><span class="source js"><span class="meta export js"><span>&nbsp;</span></span></span></div><div class="line"><span class="source js"><span class="meta export js"><span>&nbsp;&nbsp;</span><span class="variable other module js"><span>next</span></span><span>:&nbsp;</span><span class="variable other module js"><span>Hook</span></span><span>&nbsp;|&nbsp;</span><span class="variable other module js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></div><div class="line"><span class="source js"><span class="meta export js"><span class="punctuation definition modules end js"><span>}</span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;ReactFiberHooks.js</span></span></span></div><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>createHook</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>:&nbsp;Hook&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;memoizedState</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;baseState</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;queue</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;baseUpdate</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;next</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></pre>
<p>훅에는 몇 가지 추가 속성이 있지만 훅의 작동 방식을 이해하는 열쇠는 <code>memoizedState</code> 와 <code>next</code> 내에 있습니다. 나머지 프로퍼티들은 <code>useReducer()</code> 훅에 의해 특별히 사용되어 <code>디스패치 된 액션(dispatched actions)</code>과 <code>기본 상태들(base states)</code>를 캐싱하므로 다양한 경우를 대비하여 reduction process가 반복 될 수 있습니다 :</p>
<ul>
<li><code>baseState</code> - reducer 에 주어진 상태 객체.</li>
<li><code>baseUpdate</code> -<code>baseState</code>를 생성 한 가장 최근의 dispatch 된 액션입니다. (ex. [state, setState] = useState(0); setState(액션))</li>
<li><code>queue</code> - dispatch 된 액션의 대기열(queue), reducer 를 통해 처리되길 기다리는 액션들이다.</li>
</ul>
<p>각 함수형 <code>fiber</code>마다 memoizedState field 에 <code>hook</code>을 지니고 있다.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;Hooks&nbsp;are&nbsp;stored&nbsp;as&nbsp;a&nbsp;linked&nbsp;list&nbsp;on&nbsp;the&nbsp;fiber&#39;s&nbsp;memoizedState&nbsp;field.&nbsp;The</span></span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;current&nbsp;hook&nbsp;list&nbsp;is&nbsp;the&nbsp;list&nbsp;that&nbsp;belongs&nbsp;to&nbsp;the&nbsp;current&nbsp;fiber.&nbsp;The</span></span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;work-in-progress&nbsp;hook&nbsp;list&nbsp;is&nbsp;a&nbsp;new&nbsp;list&nbsp;that&nbsp;will&nbsp;be&nbsp;added&nbsp;to&nbsp;the</span></span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;work-in-progress&nbsp;fiber.</span></span></span></div><div class="line"><span class="source js"><span class="storage type var js"><span>let</span></span><span>&nbsp;firstCurrentHook</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;Hook&nbsp;</span><span class="keyword operator bitwise js"><span>|</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="storage type var js"><span>let</span></span><span>&nbsp;currentHook</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;Hook&nbsp;</span><span class="keyword operator bitwise js"><span>|</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="storage type var js"><span>let</span></span><span>&nbsp;firstWorkInProgressHook</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;Hook&nbsp;</span><span class="keyword operator bitwise js"><span>|</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="storage type var js"><span>let</span></span><span>&nbsp;workInProgressHook</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;Hook&nbsp;</span><span class="keyword operator bitwise js"><span>|</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;</span><span class="markup underline link https hyperlink"><span>https://github.com/facebook/react/blob/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactFiberHooks.js?source=post_page---------------------------#L367</span></span></span></span></div><div class="line"><span class="source js"><span class="meta export js"><span class="keyword control js"><span>export</span></span><span>&nbsp;</span></span><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;useReducer&lt;S,&nbsp;A&gt;</span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function js"><span class="meta parameters js"><span>&nbsp;&nbsp;</span><span class="meta function arrow json js"><span class="entity name function js"><span>reducer</span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="constant other js"><span>S</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="constant other js"><span>A</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="constant other js"><span>S</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function js"><span class="meta parameters js"><span>&nbsp;&nbsp;</span><span class="variable parameter function js"><span>initialState</span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant other js"><span>S</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function js"><span class="meta parameters js"><span>&nbsp;&nbsp;</span><span class="variable parameter function js"><span>initialAction</span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant other js"><span>A</span></span><span>&nbsp;</span><span class="keyword operator bitwise js"><span>|</span></span><span>&nbsp;</span><span class="keyword operator void js"><span>void</span></span><span>&nbsp;</span><span class="keyword operator bitwise js"><span>|</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>:&nbsp;[S,&nbsp;Dispatch&lt;A&gt;]&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;currentlyRenderingFiber&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>resolveCurrentlyRenderingFiber</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;workInProgressHook&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>createWorkInProgressHook</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage type var js"><span>let</span></span><span>&nbsp;queue</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;UpdateQueue</span><span class="keyword operator comparison js"><span>&lt;</span></span><span class="constant other js"><span>A</span></span><span class="keyword operator comparison js"><span>&gt;</span></span><span>&nbsp;</span><span class="keyword operator bitwise js"><span>|</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span class="variable other object js"><span>workInProgressHook</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>queue</span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;any</span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;..&nbsp;생략..</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;업데이트&nbsp;시</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;//&nbsp;재&nbsp;렌더시&nbsp;(isReRender)&nbsp;-&nbsp;workInProgressHook에&nbsp;next가&nbsp;존재할&nbsp;경우&nbsp;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span>dispatch</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant other js"><span>Dispatch</span></span><span>&lt;</span><span class="constant other js"><span>A</span></span><span>&gt;&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span class="variable other object js"><span>queue</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>dispatch</span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;any</span><span class="meta brace round js"><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;재&nbsp;렌더가&nbsp;아닐&nbsp;경우</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;첫&nbsp;렌더시&nbsp;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="variable other object js"><span>workInProgressHook</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>memoizedState</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>workInProgressHook</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>baseState</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;initialState</span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;queue&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>workInProgressHook</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>queue</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;last</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;dispatch</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span>dispatch</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant other js"><span>Dispatch</span></span><span>&lt;</span><span class="constant other js"><span>A</span></span><span>&gt;&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span class="variable other object js"><span>queue</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>dispatch</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span class="variable other object js"><span>dispatchAction</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>bind</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;currentlyRenderingFiber</span><span class="meta delimiter object comma js"><span>,</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;queue</span><span class="meta delimiter object comma js"><span>,</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;any</span><span class="meta brace round js"><span>)</span><span>)</span></span><span class="punctuation terminator statement js"><span>;</span></span><span>&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;action&nbsp;만&nbsp;나중에&nbsp;받게끔&nbsp;dispatch를&nbsp;bind&nbsp;시킴.</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="meta brace square js"><span>[</span></span><span class="variable other object js"><span>workInProgressHook</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>memoizedState</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;dispatch</span><span class="meta brace square js"><span>]</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;useState에서&nbsp;사용하는&nbsp;reducer에는&nbsp;basicStateReducer&nbsp;사용</span></span></span></div><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>basicStateReducer</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>state</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>action</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="keyword operator typeof js"><span>typeof</span></span><span>&nbsp;action&nbsp;</span><span class="keyword operator comparison js"><span>===</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>function</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator ternary js"><span>?</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>action</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>state</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="keyword operator ternary js"><span>:</span></span><span>&nbsp;action</span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></pre>
<blockquote>
<p>여기서 reducer 는 action 과 payload state 를 받아서 새로운 state 를 반환하는 순수함수라 할 수 있겠다. baseUpdate 는 액션이라고 보면 될것이다.</p>
</blockquote>
<p>불행하게도 거의 모든 경우를 재현 할 수 없었기 때문에 reducer hook 을 잘 이해할 수 없었습니다. 그래서 정교하게 느껴지지 않을 것입니다. 나는 단지 reducer 구현이 너무 일관성이 없기 때문에 <a href="https://github.com/facebook/react/blob/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactFiberHooks.js?source=post_page---------------------------#L380">implementation</a> 에서 구현 자체의 주석 중 하나조차도 “(이것이) 원하는 의미론이 맞는지 확실치 않다(TODO: Not sure if this is the desired semantics, but it’s what we do for gDSFP. I can’t remember why.)” 라고 말합니다. 그래서 어떻게 확신해야합니까?!</p>
<p>후크로 돌아가서, 각각의 모든 컴포넌트 호출 이전에,  <a href="https://github.com/facebook/react/blob/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactFiberHooks.js#L123"><code>prepareHooks()</code></a>라는 이름의 함수가 호출됩니다. <strong>이 함수안에서는 current fiber 와 hooks 큐(대기열) 안에 있는 그것의 첫 번째 hook 노드는 전역 변수에 저장됩니다. 이런 방식으로, 우리가 후크 함수 (<code>useXXX ()</code>)를 호출 할 때마다 어떤 컨텍스트에서 실행되는지를 알 수 있습니다.</strong></p>
<blockquote>
<p><code>prepareHooks()</code> 이 함수가 보이지 않는다. <code>prepareToUseHooks()</code> 이 함수인거 같다.</p>
</blockquote>
<p>다음은 Hooks 대기열이 실행되는 간단한 코드 형식이다.</p>
<pre class="editor editor-colors"><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="storage type type ts"><span>type</span></span><span>&nbsp;</span><span class="entity name type alias ts"><span>Update</span></span><span class="meta type parameters ts"><span class="punctuation definition typeparameters begin ts"><span>&lt;</span></span><span class="entity name type ts"><span>A</span></span><span class="punctuation definition typeparameters end ts"><span>&gt;</span></span></span><span>&nbsp;</span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="meta object type ts"><span class="punctuation definition block ts"><span>{</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="meta object type ts"><span>&nbsp;&nbsp;</span><span class="meta field declaration ts"><span class="meta definition property ts variable object property ts"><span>expirationTime</span></span><span class="meta type annotation ts"><span class="keyword operator type annotation ts"><span>:</span></span><span>&nbsp;</span><span class="entity name type ts"><span>ExpirationTime</span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="meta object type ts"><span>&nbsp;&nbsp;</span><span class="meta field declaration ts"><span class="meta definition property ts variable object property ts"><span>action</span></span><span class="meta type annotation ts"><span class="keyword operator type annotation ts"><span>:</span></span><span>&nbsp;</span><span class="entity name type ts"><span>A</span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="meta object type ts"><span>&nbsp;&nbsp;</span><span class="meta field declaration ts"><span class="meta definition property ts variable object property ts"><span>next</span></span><span class="meta type annotation ts"><span class="keyword operator type annotation ts"><span>:</span></span><span>&nbsp;</span><span class="entity name type ts"><span>Update</span></span><span class="meta type parameters ts"><span class="punctuation definition typeparameters begin ts"><span>&lt;</span></span><span class="entity name type ts"><span>A</span></span><span class="punctuation definition typeparameters end ts"><span>&gt;</span></span></span><span>&nbsp;</span><span class="keyword operator type ts"><span>|</span></span><span>&nbsp;</span><span class="support type builtin ts"><span>null</span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="meta object type ts"><span class="punctuation definition block ts"><span>}</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span>&nbsp;</span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="storage type type ts"><span>type</span></span><span>&nbsp;</span><span class="entity name type alias ts"><span>UpdateQueue</span></span><span class="meta type parameters ts"><span class="punctuation definition typeparameters begin ts"><span>&lt;</span></span><span class="entity name type ts"><span>A</span></span><span class="punctuation definition typeparameters end ts"><span>&gt;</span></span></span><span>&nbsp;</span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="meta object type ts"><span class="punctuation definition block ts"><span>{</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="meta object type ts"><span>&nbsp;&nbsp;</span><span class="meta field declaration ts"><span class="meta definition property ts variable object property ts"><span>last</span></span><span class="meta type annotation ts"><span class="keyword operator type annotation ts"><span>:</span></span><span>&nbsp;</span><span class="entity name type ts"><span>Update</span></span><span class="meta type parameters ts"><span class="punctuation definition typeparameters begin ts"><span>&lt;</span></span><span class="entity name type ts"><span>A</span></span><span class="punctuation definition typeparameters end ts"><span>&gt;</span></span></span><span>&nbsp;</span><span class="keyword operator type ts"><span>|</span></span><span>&nbsp;</span><span class="support type builtin ts"><span>null</span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="meta object type ts"><span>&nbsp;&nbsp;</span><span class="meta field declaration ts"><span class="meta definition property ts variable object property ts"><span>dispatch</span></span><span class="meta type annotation ts"><span class="keyword operator type annotation ts"><span>:</span></span><span>&nbsp;</span><span class="support type primitive ts"><span>any</span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="meta object type ts"><span class="punctuation definition block ts"><span>}</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="storage type type ts"><span>type</span></span><span>&nbsp;</span><span class="entity name type alias ts"><span>Hook</span></span><span>&nbsp;</span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="meta object type ts"><span class="punctuation definition block ts"><span>{</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="meta object type ts"><span>&nbsp;&nbsp;</span><span class="meta field declaration ts"><span class="meta definition property ts variable object property ts"><span>memoizedState</span></span><span class="meta type annotation ts"><span class="keyword operator type annotation ts"><span>:</span></span><span>&nbsp;</span><span class="support type primitive ts"><span>any</span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="meta object type ts"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="meta object type ts"><span>&nbsp;&nbsp;</span><span class="meta field declaration ts"><span class="meta definition property ts variable object property ts"><span>baseState</span></span><span class="meta type annotation ts"><span class="keyword operator type annotation ts"><span>:</span></span><span>&nbsp;</span><span class="support type primitive ts"><span>any</span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="meta object type ts"><span>&nbsp;&nbsp;</span><span class="meta field declaration ts"><span class="meta definition property ts variable object property ts"><span>baseUpdate</span></span><span class="meta type annotation ts"><span class="keyword operator type annotation ts"><span>:</span></span><span>&nbsp;</span><span class="entity name type ts"><span>Update</span></span><span class="meta type parameters ts"><span class="punctuation definition typeparameters begin ts"><span>&lt;</span></span><span class="support type primitive ts"><span>any</span></span><span class="punctuation definition typeparameters end ts"><span>&gt;</span></span></span><span>&nbsp;</span><span class="keyword operator type ts"><span>|</span></span><span>&nbsp;</span><span class="support type builtin ts"><span>null</span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="meta object type ts"><span>&nbsp;&nbsp;</span><span class="meta field declaration ts"><span class="meta definition property ts variable object property ts"><span>queue</span></span><span class="meta type annotation ts"><span class="keyword operator type annotation ts"><span>:</span></span><span>&nbsp;</span><span class="entity name type ts"><span>UpdateQueue</span></span><span class="meta type parameters ts"><span class="punctuation definition typeparameters begin ts"><span>&lt;</span></span><span class="support type primitive ts"><span>any</span></span><span class="punctuation definition typeparameters end ts"><span>&gt;</span></span></span><span>&nbsp;</span><span class="keyword operator type ts"><span>|</span></span><span>&nbsp;</span><span class="support type builtin ts"><span>null</span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="meta object type ts"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="meta object type ts"><span>&nbsp;&nbsp;</span><span class="meta field declaration ts"><span class="meta definition property ts variable object property ts"><span>next</span></span><span class="meta type annotation ts"><span class="keyword operator type annotation ts"><span>:</span></span><span>&nbsp;</span><span class="entity name type ts"><span>Hook</span></span><span>&nbsp;</span><span class="keyword operator type ts"><span>|</span></span><span>&nbsp;</span><span class="support type builtin ts"><span>null</span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="meta object type ts"><span class="punctuation definition block ts"><span>}</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span>&nbsp;</span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;The&nbsp;work-in-progress&nbsp;fiber.&nbsp;I&#39;ve&nbsp;named&nbsp;it&nbsp;differently&nbsp;to&nbsp;distinguish&nbsp;it&nbsp;from</span></span></span></span></div><div class="line"><span class="source ts"><span class="meta type declaration ts"><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;the&nbsp;work-in-progress&nbsp;hook.</span></span></span></span></div><div class="line"><span class="source ts"><span class="meta var expr ts"><span class="storage type ts"><span>let</span></span><span>&nbsp;</span><span class="meta var-single-variable expr ts"><span class="meta definition variable ts variable other readwrite ts"><span>currentlyRenderingFiber</span></span><span class="meta type annotation ts"><span class="keyword operator type annotation ts"><span>:</span></span><span>&nbsp;</span><span class="entity name type ts"><span>Fiber</span></span><span>&nbsp;</span><span class="keyword operator type ts"><span>|</span></span><span>&nbsp;</span><span class="support type builtin ts"><span>null</span></span><span>&nbsp;</span></span></span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="constant language null ts"><span>null</span></span></span></span></div><div class="line"><span class="source ts"><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;Hooks&nbsp;are&nbsp;stored&nbsp;as&nbsp;a&nbsp;linked&nbsp;list&nbsp;on&nbsp;the&nbsp;fiber&#39;s&nbsp;memoizedState&nbsp;field.&nbsp;The</span></span></span></div><div class="line"><span class="source ts"><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;current&nbsp;hook&nbsp;list&nbsp;is&nbsp;the&nbsp;list&nbsp;that&nbsp;belongs&nbsp;to&nbsp;the&nbsp;current&nbsp;fiber.&nbsp;The</span></span></span></div><div class="line"><span class="source ts"><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;work-in-progress&nbsp;hook&nbsp;list&nbsp;is&nbsp;a&nbsp;new&nbsp;list&nbsp;that&nbsp;will&nbsp;be&nbsp;added&nbsp;to&nbsp;the</span></span></span></div><div class="line"><span class="source ts"><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;work-in-progress&nbsp;fiber.</span></span></span></div><div class="line"><span class="source ts"><span class="meta var expr ts"><span class="storage type ts"><span>let</span></span><span>&nbsp;</span><span class="meta var-single-variable expr ts"><span class="meta definition variable ts variable other readwrite ts"><span>workInProgressHook</span></span><span class="meta type annotation ts"><span class="keyword operator type annotation ts"><span>:</span></span><span>&nbsp;</span><span class="entity name type ts"><span>Hook</span></span><span>&nbsp;</span><span class="keyword operator type ts"><span>|</span></span><span>&nbsp;</span><span class="support type builtin ts"><span>null</span></span><span>&nbsp;</span></span></span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="constant language null ts"><span>null</span></span></span></span></div><div class="line"><span class="source ts"><span class="meta var expr ts"><span class="storage type ts"><span>let</span></span><span>&nbsp;</span><span class="meta var-single-variable expr ts"><span class="meta definition variable ts variable other readwrite ts"><span>currentHook</span></span><span class="meta type annotation ts"><span class="keyword operator type annotation ts"><span>:</span></span><span>&nbsp;</span><span class="entity name type ts"><span>Hook</span></span><span>&nbsp;</span><span class="keyword operator type ts"><span>|</span></span><span>&nbsp;</span><span class="support type builtin ts"><span>null</span></span><span>&nbsp;</span></span></span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="constant language null ts"><span>null</span></span></span></span></div><div class="line"><span class="source ts"><span>&nbsp;</span></span></div><div class="line"><span class="source ts"><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;Source:&nbsp;</span><span class="markup underline link https hyperlink"><span>https://github.com/facebook/react/blob/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactFiberHooks.js#L123</span></span></span></span></div><div class="line"><span class="source ts"><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;2.&nbsp;전역에&nbsp;셋팅</span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="storage type function ts"><span>function</span></span><span>&nbsp;</span><span class="meta definition function ts entity name function ts"><span>prepareHooks</span></span><span class="meta parameters ts"><span class="punctuation definition parameters begin ts"><span>(</span></span><span class="variable parameter ts"><span>current</span></span><span class="meta type annotation ts"><span class="keyword operator type annotation ts"><span>:</span></span><span>&nbsp;</span><span class="entity name type ts"><span>Fiber</span></span><span>&nbsp;</span><span class="keyword operator type ts"><span>|</span></span><span>&nbsp;</span><span class="support type builtin ts"><span>null</span></span></span><span class="punctuation separator parameter ts"><span>,</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta parameters ts"><span>&nbsp;&nbsp;</span><span class="variable parameter ts"><span>workInProgress</span></span><span class="meta type annotation ts"><span class="keyword operator type annotation ts"><span>:</span></span><span>&nbsp;</span><span class="entity name type ts"><span>Fiber</span></span></span><span class="punctuation separator parameter ts"><span>,</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta parameters ts"><span>&nbsp;&nbsp;</span><span class="variable parameter ts"><span>nextRenderExpirationTime</span></span><span class="meta type annotation ts"><span class="keyword operator type annotation ts"><span>:</span></span><span>&nbsp;</span><span class="entity name type ts"><span>ExpirationTime</span></span></span><span class="punctuation separator parameter ts"><span>,</span></span><span class="punctuation definition parameters end ts"><span>)</span></span></span><span>&nbsp;</span><span class="meta block ts"><span class="punctuation definition block ts"><span>{</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="variable other readwrite ts"><span>renderExpirationTime</span></span><span>&nbsp;</span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="variable other readwrite ts"><span>nextRenderExpirationTime</span></span><span class="punctuation terminator statement ts"><span>;</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="variable other readwrite ts"><span>currentlyRenderingFiber</span></span><span>&nbsp;</span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="variable other readwrite ts"><span>workInProgress</span></span><span class="punctuation terminator statement ts"><span>;</span></span><span>&nbsp;</span><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;현재&nbsp;작업중인&nbsp;Fiber</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="variable other readwrite ts"><span>firstCurrentHook</span></span><span>&nbsp;</span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="variable other readwrite ts"><span>current</span></span><span>&nbsp;</span><span class="keyword operator comparison ts"><span>!==</span></span><span>&nbsp;</span><span class="constant language null ts"><span>null</span></span><span>&nbsp;</span><span class="keyword operator ternary ts"><span>?</span></span><span>&nbsp;</span><span class="variable other object ts"><span>current</span></span><span class="punctuation accessor ts"><span>.</span></span><span class="variable other property ts"><span>memoizedState</span></span><span>&nbsp;</span><span class="keyword operator ternary ts"><span>:</span></span><span>&nbsp;</span><span class="constant language null ts"><span>null</span></span><span class="punctuation terminator statement ts"><span>;</span></span><span>&nbsp;</span><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;이미&nbsp;render된&nbsp;Fiber(current)의&nbsp;memoizedState를&nbsp;firstCurrentHook&nbsp;할당.</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="punctuation definition block ts"><span>}</span></span></span></span></span></div><div class="line"><span class="source ts"><span>&nbsp;</span></span></div><div class="line"><span class="source ts"><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;Source:&nbsp;</span><span class="markup underline link https hyperlink"><span>https://github.com/facebook/react/tree/5f06576f51ece88d846d01abd2ddd575827c6127/react-reconciler/src/ReactFiberHooks.js:148</span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="storage type function ts"><span>function</span></span><span>&nbsp;</span><span class="meta definition function ts entity name function ts"><span>finishHooks</span></span><span class="meta parameters ts"><span class="punctuation definition parameters begin ts"><span>(</span></span><span class="punctuation definition parameters end ts"><span>)</span></span></span><span>&nbsp;</span><span class="meta block ts"><span class="punctuation definition block ts"><span>{</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="variable other object ts"><span>currentlyRenderingFiber</span></span><span class="punctuation accessor ts"><span>.</span></span><span class="variable other property ts"><span>memoizedState</span></span><span>&nbsp;</span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="variable other readwrite ts"><span>firstWorkInProgressHook</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="variable other readwrite ts"><span>currentlyRenderingFiber</span></span><span>&nbsp;</span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="constant language null ts"><span>null</span></span><span class="punctuation terminator statement ts"><span>;</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="variable other readwrite ts"><span>firstCurrentHook</span></span><span>&nbsp;</span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="constant language null ts"><span>null</span></span><span class="punctuation terminator statement ts"><span>;</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="variable other readwrite ts"><span>currentHook</span></span><span>&nbsp;</span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="constant language null ts"><span>null</span></span><span class="punctuation terminator statement ts"><span>;</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="variable other readwrite ts"><span>firstWorkInProgressHook</span></span><span>&nbsp;</span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="constant language null ts"><span>null</span></span><span class="punctuation terminator statement ts"><span>;</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="variable other readwrite ts"><span>workInProgressHook</span></span><span>&nbsp;</span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="constant language null ts"><span>null</span></span><span class="punctuation terminator statement ts"><span>;</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="punctuation definition block ts"><span>}</span></span></span></span></span></div><div class="line"><span class="source ts"><span>&nbsp;</span></span></div><div class="line"><span class="source ts"><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;Source:&nbsp;</span><span class="markup underline link https hyperlink"><span>https://github.com/facebook/react/blob/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactFiberHooks.js#L332</span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="storage type function ts"><span>function</span></span><span>&nbsp;</span><span class="meta definition function ts entity name function ts"><span>resolveCurrentlyRenderingFiber</span></span><span class="meta parameters ts"><span class="punctuation definition parameters begin ts"><span>(</span></span><span class="punctuation definition parameters end ts"><span>)</span></span></span><span>&nbsp;</span><span class="meta block ts"><span class="punctuation definition block ts"><span>{</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="keyword control conditional ts"><span>if</span></span><span>&nbsp;</span><span class="meta brace round ts"><span>(</span></span><span class="variable other readwrite ts"><span>currentlyRenderingFiber</span></span><span class="meta brace round ts"><span>)</span></span><span>&nbsp;</span><span class="keyword control flow ts"><span>return</span></span><span>&nbsp;</span><span class="variable other readwrite ts"><span>currentlyRenderingFiber</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="keyword control trycatch ts"><span>throw</span></span><span>&nbsp;</span><span class="meta function-call ts"><span class="support class error ts"><span>Error</span></span></span><span class="meta brace round ts"><span>(</span></span><span class="string quoted double ts"><span class="punctuation definition string begin ts"><span>&quot;</span></span><span>Hooks&nbsp;can&#39;t&nbsp;be&nbsp;called</span><span class="punctuation definition string end ts"><span>&quot;</span></span></span><span class="meta brace round ts"><span>)</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="punctuation definition block ts"><span>}</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;Source:&nbsp;</span><span class="markup underline link https hyperlink"><span>https://github.com/facebook/react/blob/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactFiberHooks.js#L267</span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="storage type function ts"><span>function</span></span><span>&nbsp;</span><span class="meta definition function ts entity name function ts"><span>createWorkInProgressHook</span></span><span class="meta parameters ts"><span class="punctuation definition parameters begin ts"><span>(</span></span><span class="punctuation definition parameters end ts"><span>)</span></span></span><span>&nbsp;</span><span class="meta block ts"><span class="punctuation definition block ts"><span>{</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="punctuation whitespace comment leading ts"><span>&nbsp;&nbsp;</span></span><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;workInProgressHook&nbsp;가&nbsp;존재하고&nbsp;next가&nbsp;존재하지&nbsp;않으면&nbsp;hook을&nbsp;새로&nbsp;만들어서&nbsp;workInProgressHook&nbsp;=&nbsp;workInProgressHook.next&nbsp;=&nbsp;hook;</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="punctuation whitespace comment leading ts"><span>&nbsp;&nbsp;</span></span><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;workInProgressHook&nbsp;가&nbsp;존재하고&nbsp;next가&nbsp;존재하면&nbsp;workInProgressHook&nbsp;=&nbsp;workInProgressHook.next;</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="punctuation whitespace comment leading ts"><span>&nbsp;&nbsp;</span></span><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;workInProgressHook&nbsp;가&nbsp;존재하지&nbsp;않고&nbsp;firstWorkInProgressHook가&nbsp;존재하지&nbsp;않으면&nbsp;firstWorkInProgressHook&nbsp;=&nbsp;workInProgressHook;</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="punctuation whitespace comment leading ts"><span>&nbsp;&nbsp;</span></span><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;기존&nbsp;fiber에&nbsp;등록된&nbsp;훅이&nbsp;있으면&nbsp;그&nbsp;훅을&nbsp;복사해서&nbsp;사용하고&nbsp;그게&nbsp;아니라면&nbsp;새로운&nbsp;훅을&nbsp;생성한다.&nbsp;</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="variable other readwrite ts"><span>workInProgressHook</span></span><span>&nbsp;</span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="variable other readwrite ts"><span>currentHook</span></span><span>&nbsp;</span><span class="keyword operator ternary ts"><span>?</span></span><span>&nbsp;</span><span class="meta function-call ts"><span class="entity name function ts"><span>cloneHook</span></span></span><span class="meta brace round ts"><span>(</span></span><span class="variable other readwrite ts"><span>currentHook</span></span><span class="meta brace round ts"><span>)</span></span><span>&nbsp;</span><span class="keyword operator ternary ts"><span>:</span></span><span>&nbsp;</span><span class="meta function-call ts"><span class="entity name function ts"><span>createNewHook</span></span></span><span class="meta brace round ts"><span>(</span><span>)</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="variable other readwrite ts"><span>currentHook</span></span><span>&nbsp;</span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="variable other readwrite ts"><span>currentHook</span></span><span>&nbsp;</span><span class="keyword operator comparison ts"><span>!==</span></span><span>&nbsp;</span><span class="constant language null ts"><span>null</span></span><span>&nbsp;</span><span class="keyword operator ternary ts"><span>?</span></span><span>&nbsp;</span><span class="variable other object ts"><span>currentHook</span></span><span class="punctuation accessor ts"><span>.</span></span><span class="support variable property dom ts"><span>next</span></span><span>&nbsp;</span><span class="keyword operator ternary ts"><span>:</span></span><span>&nbsp;</span><span class="constant language null ts"><span>null</span></span><span class="punctuation terminator statement ts"><span>;</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="keyword control flow ts"><span>return</span></span><span>&nbsp;</span><span class="variable other readwrite ts"><span>workInProgressHook</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="punctuation definition block ts"><span>}</span></span></span></span></span></div><div class="line"><span class="source ts"><span>&nbsp;</span></span></div><div class="line"><span class="source ts"><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;4.&nbsp;컴포넌트&nbsp;안에서&nbsp;호출되는&nbsp;useXXX&nbsp;함수.</span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="storage type function ts"><span>function</span></span><span>&nbsp;</span><span class="meta definition function ts entity name function ts"><span>useXXX</span></span><span class="meta parameters ts"><span class="punctuation definition parameters begin ts"><span>(</span></span><span class="punctuation definition parameters end ts"><span>)</span></span></span><span>&nbsp;</span><span class="meta block ts"><span class="punctuation definition block ts"><span>{</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="meta var expr ts"><span class="storage type ts"><span>const</span></span><span>&nbsp;</span><span class="meta var-single-variable expr ts"><span class="meta definition variable ts variable other readwrite ts"><span>fiber</span></span><span>&nbsp;</span></span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="meta function-call ts"><span class="entity name function ts"><span>resolveCurrentlyRenderingFiber</span></span></span><span class="meta brace round ts"><span>(</span><span>)</span></span><span>&nbsp;</span><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;update&nbsp;될&nbsp;fiber&nbsp;리턴.</span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="meta var expr ts"><span class="storage type ts"><span>const</span></span><span>&nbsp;</span><span class="meta var-single-variable expr ts"><span class="meta definition variable ts variable other readwrite ts"><span>hook</span></span><span>&nbsp;</span></span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="meta function-call ts"><span class="entity name function ts"><span>createWorkInProgressHook</span></span></span><span class="meta brace round ts"><span>(</span><span>)</span></span><span>&nbsp;</span><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>현재&nbsp;렌더링된&nbsp;fiber의&nbsp;memoizedState</span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="punctuation whitespace comment leading ts"><span>&nbsp;&nbsp;</span></span><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;...</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="punctuation definition block ts"><span>}</span></span></span></span></span></div><div class="line"><span class="source ts"><span>&nbsp;</span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="storage type function ts"><span>function</span></span><span>&nbsp;</span><span class="meta definition function ts entity name function ts"><span>updateFunctionComponent</span></span><span class="meta parameters ts"><span class="punctuation definition parameters begin ts"><span>(</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta parameters ts"><span>&nbsp;&nbsp;</span><span class="variable parameter ts"><span>recentFiber</span></span><span class="punctuation separator parameter ts"><span>,</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta parameters ts"><span>&nbsp;&nbsp;</span><span class="variable parameter ts"><span>workInProgressFiber</span></span><span class="punctuation separator parameter ts"><span>,</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta parameters ts"><span>&nbsp;&nbsp;</span><span class="variable parameter ts"><span>Component</span></span><span class="punctuation separator parameter ts"><span>,</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta parameters ts"><span>&nbsp;&nbsp;</span><span class="variable parameter ts"><span>props</span></span><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta parameters ts"><span class="punctuation definition parameters end ts"><span>)</span></span></span><span>&nbsp;</span><span class="meta block ts"><span class="punctuation definition block ts"><span>{</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="meta function-call ts"><span class="entity name function ts"><span>prepareHooks</span></span></span><span class="meta brace round ts"><span>(</span></span><span class="variable other readwrite ts"><span>recentFiber</span></span><span class="punctuation separator comma ts"><span>,</span></span><span>&nbsp;</span><span class="variable other readwrite ts"><span>workInProgressFiber</span></span><span class="meta brace round ts"><span>)</span></span><span>&nbsp;</span><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;1.&nbsp;훅&nbsp;준비</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="meta function-call ts"><span class="entity name function ts"><span>Component</span></span></span><span class="meta brace round ts"><span>(</span></span><span class="variable other readwrite ts"><span>props</span></span><span class="meta brace round ts"><span>)</span></span><span>&nbsp;</span><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;3.&nbsp;컴포넌트&nbsp;호출&nbsp;-&nbsp;여기서&nbsp;useXXX&nbsp;호출할&nbsp;것이다.</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="meta function-call ts"><span class="entity name function ts"><span>finishHooks</span></span></span><span class="meta brace round ts"><span>(</span><span>)</span></span><span>&nbsp;</span><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;5.&nbsp;Hooks&nbsp;마무리</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="punctuation definition block ts"><span>}</span></span></span></span></span></div></pre>
<p>업데이트가 완료되면, <a href="https://github.com/facebook/react/tree/5f06576f51ece88d846d01abd2ddd575827c6127/react-reconciler/src/ReactFiberHooks.js:148?source=post_page---------------------------"><code>finishHooks()</code></a> 이 호출 될 것입니다. 여기서 후크 대기열(hooks queue)의 첫 번째 노드에 대한 참조가 렌더링 된 fiber 의 <code>memoizedState</code> 속성에 저장됩니다. 즉, 후크 대기열과 그 상태를 외부 적으로 처리 할 수 ​​있습니다.</p>
<p>컴퍼넌트의 메모 상태의 외부 읽기.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>ChildComponent</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function arrow js"><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>useState</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>foo</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>useState</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>bar</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>useState</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>baz</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>ParentComponent</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function arrow js"><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>childFiberRef</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>useRef</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>useEffect</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="meta function arrow js"><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;자식이&nbsp;mount&nbsp;된&nbsp;후에&nbsp;실행된다.</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="storage type var js"><span>let</span></span><span>&nbsp;hookNode&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>childFiberRef</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="support variable property dom js"><span>current</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>memoizedState</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;</span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>assert</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="variable other object js"><span>hookNode</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>memoizedState</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>foo</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;hookNode&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>hooksNode</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="support variable property dom js"><span>next</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>assert</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="variable other object js"><span>hookNode</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>memoizedState</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>bar</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;hookNode&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>hooksNode</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="support variable property dom js"><span>next</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>assert</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="variable other object js"><span>hookNode</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>memoizedState</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>baz</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;</span><span class="punctuation definition function body end bracket curly js"><span>}</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="keyword operator comparison js"><span>&lt;</span></span><span>ChildComponent&nbsp;ref</span><span class="keyword operator assignment js"><span>=</span></span><span class="meta brace curly js"><span>{</span></span><span>childFiberRef</span><span class="meta brace curly js"><span>}</span></span><span>&nbsp;</span><span class="keyword operator js"><span>/</span></span><span class="keyword operator comparison js"><span>&gt;</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></pre>
<p>가장 일반적인 상태 후크부터 시작하여 개별 후크에 대해 더 구체적으로 설명하고 이야기하겠습니다.</p>
<h2>State hooks</h2>
<p>놀랍지만 <code>useState</code> 훅 뒤에선 <code>useReducer</code> 를 사용하고 단순히 미리 정의 된 reducer 핸들러를 제공합니다 (see <a href="https://github.com/facebook/react/blob/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactFiberHooks.js?source=post_page---------------------------#L339">implementation</a>). 즉, <code>useState</code> 에 의해 리턴 된 결과는 실제로 reducer 상태(state)와 action 디스패처(dispatcher)입니다. 상태 후크가 사용하는 reducer 핸들러를 살펴 보시기 바랍니다.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>basicStateReducer</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>state</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>action</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="keyword operator typeof js"><span>typeof</span></span><span>&nbsp;action&nbsp;</span><span class="keyword operator comparison js"><span>===</span></span><span>&nbsp;</span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>function</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span>&nbsp;</span><span class="keyword operator ternary js"><span>?</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>action</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>state</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="keyword operator ternary js"><span>:</span></span><span>&nbsp;action</span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta export js"><span class="keyword control js"><span>export</span></span><span>&nbsp;</span></span><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;useState&lt;S&gt;</span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function js"><span class="meta parameters js"><span>&nbsp;&nbsp;</span><span class="variable parameter function js"><span>initialState</span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span class="meta function arrow js"><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="constant other js"><span>S</span></span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="keyword operator bitwise js"><span>|</span></span><span>&nbsp;</span><span class="constant other js"><span>S</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function js"><span class="meta parameters js"><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>:&nbsp;[S,&nbsp;Dispatch&lt;BasicStateAction&lt;S&gt;&gt;]&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>useReducer</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;basicStateReducer</span><span class="meta delimiter object comma js"><span>,</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;useReducer&nbsp;has&nbsp;a&nbsp;special&nbsp;case&nbsp;to&nbsp;support&nbsp;lazy&nbsp;useState&nbsp;initializers</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace round js"><span>(</span></span><span>initialState</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;any</span><span class="meta brace round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;return&nbsp;[state,&nbsp;dispatchState]</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;dispatchState(value)&nbsp;=&gt;&nbsp;basicStateReducer&nbsp;함수의&nbsp;action에&nbsp;value&nbsp;값이&nbsp;할당되고&nbsp;action은&nbsp;함수가&nbsp;아니기에</span></span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;바로&nbsp;action이&nbsp;리턴되고&nbsp;state에&nbsp;할당된다.</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;그럼&nbsp;만약에&nbsp;dispatchState((state)&nbsp;=&gt;&nbsp;state&nbsp;+&nbsp;10)&nbsp;이라고&nbsp;하면&nbsp;될까???&nbsp;된다.!!!</span></span></span></div><div class="line"><span class="source js"><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;&lt;button&nbsp;onClick={()&nbsp;=&gt;&nbsp;setCount((count)&nbsp;=&gt;&nbsp;count+10)}&gt;increse&lt;/button&gt;</span></span></span></div></pre>
<p><code>useReducer()</code> 함수는 간단하게 이렇게 작성될 수 있다. <a href="https://github.com/facebook/react/blob/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactFiberHooks.js?source=post_page---------------------------#L346">useReducer</a></p>
<p>함수형 컴포넌트가 실행되고 나면 현재 fiber랑 해당 fiber에 hook을 전역으로 준비해둔다. 그리고 나서 <code>useState</code>를 호출이 되면 내부적으로 <code>useReduce</code> 함수가 실행이 되고 이 안에서 필요한 <code>hook</code> 을 만들어내거나 참조하게 된다. 그리고 나서 hook의 state와 dispatch를 리턴하고 나면 함수형 컴포넌트가 끝날쯤에 <code>finishHooks</code>을 호출 해당되는 hook의 첫번째 참조값을 해당 fiber의 memoizedState에 연결해두고 전역변수 들을 정리한다. </p>
<p>아래 함수에서 <code>useState</code>호출시 <code>useReducer</code>를 호출 후 리턴 배열이 리턴이 되는데 이때 <code>dispatch</code>가 <code>dispatchAction</code> 함수의 binding 된 함수이다. 이때 바인딩 되는 인자들은 현재 렌더링 될 fiber 를 가지고 있게 되는데 그렇다면 우리가 <code>dispatch</code> 함수를 액션을 넣어서 호출 할 때마다 어떤 fiber 와 연관되어있는지 알게 되는 것이다. 그래서 해당 fiber 에서부터 reconcile 을 하는거 같다.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta export js"><span class="keyword control js"><span>export</span></span><span>&nbsp;</span></span><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>useReducer</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;currentlyRenderingFiber&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>resolveCurrentlyRenderingFiber</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;workInProgressHook&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>createWorkInProgressHook</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage type var js"><span>let</span></span><span>&nbsp;queue</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;UpdateQueue</span><span class="keyword operator comparison js"><span>&lt;</span></span><span class="constant other js"><span>A</span></span><span class="keyword operator comparison js"><span>&gt;</span></span><span>&nbsp;</span><span class="keyword operator bitwise js"><span>|</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span class="variable other object js"><span>workInProgressHook</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>queue</span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;any</span><span class="meta brace round js"><span>)</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;...</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span>dispatch</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant other js"><span>Dispatch</span></span><span>&lt;</span><span class="constant other js"><span>A</span></span><span>&gt;&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span class="variable other object js"><span>queue</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>dispatch</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span><span class="variable other object js"><span>dispatchAction</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="entity name function js"><span>bind</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="constant language null js"><span>null</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;currentlyRenderingFiber</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;workInTree&nbsp;Fiber</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;queue</span></span></span></span></div><div class="line"><span class="source js"><span class="meta method-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;any</span><span class="meta brace round js"><span>)</span><span>)</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="meta brace square js"><span>[</span></span><span class="variable other object js"><span>workInProgressHook</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>memoizedState</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;dispatch</span><span class="meta brace square js"><span>]</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;dispatchAction&lt;A&gt;</span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>fiber</span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>Fiber</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>queue</span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>UpdateQueue</span></span><span class="keyword operator comparison js"><span>&lt;</span></span><span class="constant other js"><span>A</span></span><span class="keyword operator comparison js"><span>&gt;</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="variable parameter function js"><span>action</span></span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant other js"><span>A</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>...</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>scheduleWork</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>fiber</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;expirationTime</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></pre>
<p>예상대로 액션 디스패처에 새로운 상태를 직접 제공 할 수 있습니다. Dispatcher 에게 <em>액션 함수를 제공하여 이전 상태를 받고 새 상태를 반환 할 수도 있습니다 .</em></p>
<p>즉, 구성 요소 트리 아래로 <code>state setter</code>(useState 에서 리턴된 배열의 두번째 함수)를 보내면 다른 props 없이 상위 구성 요소의 현재 상태(current state)에 대해 변형을 실행할 수 있습니다. 예 :</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>ParentComponent</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function arrow js"><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="meta brace square js"><span>[</span></span><span class="constant other js"><span>name</span></span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="constant other js"><span>setName</span></span><span class="meta brace square js"><span>]</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>useState</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="keyword operator comparison js"><span>&lt;</span></span><span>ChildComponent&nbsp;toUpperCase</span><span class="keyword operator assignment js"><span>=</span></span><span class="meta brace curly js"><span>{</span></span><span>setName</span><span class="meta brace curly js"><span>}</span></span><span>&nbsp;</span><span class="keyword operator js"><span>/</span></span><span class="keyword operator comparison js"><span>&gt;</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>ChildComponent</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function arrow js"><span class="meta parameters js"><span class="variable parameter function js"><span>props</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta function-call js"><span class="entity name function js"><span>useEffect</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta function arrow js"><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="variable other object js"><span>props</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="support function js"><span>toUpperCase</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="meta function arrow js"><span class="meta parameters js"><span class="variable parameter function js"><span>state</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="variable other object js"><span>state</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="support function js"><span>toUpperCase</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition function body end bracket curly js"><span>}</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta brace square js"><span>[</span></span><span class="constant language boolean true js"><span>true</span></span><span class="meta brace square js"><span>]</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="meta arguments js"><span>&nbsp;&nbsp;</span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;</span><span class="constant language null js"><span>null</span></span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div></pre>
<p>마지막으로, 구성 요소의 라이플 사이클에 중요한 영향을 미치는 effect hooks 작동 방식을 알아보자.</p>
<h2>Effect hooks</h2>
<p>이펙트 후크는 약간 다르게 동작하고 내가 설명하고 싶은 추가 로직 레이어를 가지고 있습니다. 다시 한 번, 구현에 들어가기 전에 effect hook의 프로퍼티들에 대해 염두에 두어야 할 사항이 있습니다.</p>
<ul>
<li>effect hooks는 렌더링 시간 동안 생성되지만 페인팅 후에 실행됩니다.</li>
<li>그렇게되면, 그들은 다음 페인팅 직전에 파괴 될 것입니다.</li>
<li>그들은 정의된 순서대로 호출됩니다.</li>
</ul>
<p><em>“페이팅”이라는 용어를 사용하고 “렌더링” 단어는 사용하하지 않았습니다. 이 두 가지가 다른데, 나는 최근의 [</em>React Conf<em>](<a href="https://conf.reactjs.org/?source=post">https://conf.reactjs.org/?source=post</a></em>page---------------------------)에서 잘못된 용어를 사용하는 것을 많이 바왔다.! 공식 <a href="https://reactjs.org/docs/hooks-reference.html?source=post_page---------------------------#useeffect"><em>React docs</em></a>에서 “페인팅”과 같은 말을 “렌더링이 화면에 적용 된 후”라고 말합니다. render 메서드는 파이버 노드를 생성하지만 아직 아무것도 그리지 않습니다 ._</p>
<p>따라서 이러한 효과를 유지해야하는 추가 대기열이 있어야하며 페인팅 후에 처리해야합니다. 일반적으로 말하자면, fiber는 effect node들을 포함하는 대기열을 보유하고 있습니다. 각 effect는 다른 유형이므로 적절한 단계에서 해결해야합니다.</p>
<ul>
<li>mutation이 일어나기 전에 <code>getSnapshotBeforeUpdate()</code> 인스턴스를 호출한다.  (see  <a href="https://github.com/facebook/react/tree/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactFiberScheduler.js?source=post_page---------------------------#L646">implementation</a>).</li>
<li>all the host 삽입, 업데이트, 삭제 그리고 참조해제를 수행한다.  (see  <a href="https://github.com/facebook/react/tree/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactFiberScheduler.js?source=post_page---------------------------#L687">implementation</a>).</li>
<li>모든 라이프 사이클 및 참조 콜백을 수행하십시오. 라이프 사이클은 별도의 실행으로 발생하므로 전체 트리에서 모든 배치, 업데이트 및 삭제가 이미 호출되었습니다. 이 실행은 또한 렌더러 관련 초기 효과를 트리거합니다. (see  <a href="https://github.com/facebook/react/tree/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactFiberScheduler.js?source=post_page---------------------------#L732">implementation</a>).</li>
<li><code>useEffect()</code>  hook에 의해 스케쥴된 Effect - 구현에 기반한 “passive effects” 라고도 합니다. <a href="https://github.com/facebook/react/tree/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactFiberScheduler.js?source=post_page---------------------------#L779">implementation</a>  (어쩌면 우리는 React 커뮤니티에서이 용어를 사용해야 할까?).</li>
</ul>
<p>hook effects에 관해서는 fiber의 <code>updateQueue</code> 라는 속성에 저장해야하며 각 효과 노드(effect node)는 다음 스키마를 가져야합니다 ((see  <a href="https://github.com/facebook/react/tree/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactFiberHooks.js?source=post_page---------------------------#L477">implementation</a>):</p>
<pre class="editor editor-colors"><div class="line"><span class="source ts"><span class="meta function ts"><span class="storage type function ts"><span>function</span></span><span>&nbsp;</span><span class="meta definition function ts entity name function ts"><span>pushEffect</span></span><span class="meta parameters ts"><span class="punctuation definition parameters begin ts"><span>(</span></span><span class="variable parameter ts"><span>tag</span></span><span class="punctuation separator parameter ts"><span>,</span></span><span>&nbsp;</span><span class="variable parameter ts"><span>create</span></span><span class="punctuation separator parameter ts"><span>,</span></span><span>&nbsp;</span><span class="variable parameter ts"><span>destroy</span></span><span class="punctuation separator parameter ts"><span>,</span></span><span>&nbsp;</span><span class="variable parameter ts"><span>inputs</span></span><span class="punctuation definition parameters end ts"><span>)</span></span></span><span>&nbsp;</span><span class="meta block ts"><span class="punctuation definition block ts"><span>{</span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span>&nbsp;&nbsp;</span><span class="meta var expr ts"><span class="storage type ts"><span>const</span></span><span>&nbsp;</span><span class="meta var-single-variable expr ts"><span class="meta definition variable ts variable other readwrite ts"><span>effect</span></span><span class="meta type annotation ts"><span class="keyword operator type annotation ts"><span>:</span></span><span>&nbsp;</span><span class="entity name type ts"><span>Effect</span></span><span>&nbsp;</span></span></span><span class="keyword operator assignment ts"><span>=</span></span><span>&nbsp;</span><span class="meta objectliteral ts"><span class="punctuation definition block ts"><span>{</span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="meta var expr ts"><span class="meta objectliteral ts"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta object member ts"><span class="variable other readwrite ts"><span>tag</span></span></span><span class="punctuation separator comma ts"><span>,</span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="meta var expr ts"><span class="meta objectliteral ts"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta object member ts"><span class="variable other readwrite ts"><span>create</span></span></span><span class="punctuation separator comma ts"><span>,</span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="meta var expr ts"><span class="meta objectliteral ts"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta object member ts"><span class="variable other readwrite ts"><span>destroy</span></span></span><span class="punctuation separator comma ts"><span>,</span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="meta var expr ts"><span class="meta objectliteral ts"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta object member ts"><span class="variable other readwrite ts"><span>inputs</span></span></span><span class="punctuation separator comma ts"><span>,</span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="meta var expr ts"><span class="meta objectliteral ts"><span class="punctuation whitespace comment leading ts"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line double-slash ts"><span class="punctuation definition comment ts"><span>//</span></span><span>&nbsp;Circular</span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="meta var expr ts"><span class="meta objectliteral ts"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta object member ts"><span class="meta object-literal key ts"><span class="entity name function ts"><span>next</span></span></span><span class="meta object-literal key ts punctuation separator key-value ts"><span>:</span></span><span class="meta arrow ts"><span>&nbsp;</span><span class="meta parameters ts"><span class="punctuation definition parameters begin ts"><span>(</span></span><span class="variable parameter ts"><span>null</span></span><span class="meta type annotation ts"><span class="keyword operator type annotation ts"><span>:</span></span><span>&nbsp;</span><span class="support type primitive ts"><span>any</span></span></span><span class="punctuation definition parameters end ts"><span>)</span></span></span><span>,</span></span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="meta var expr ts"><span class="meta objectliteral ts"><span class="meta object member ts"><span class="meta arrow ts"><span>&nbsp;&nbsp;};&nbsp;</span></span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="meta var expr ts"><span class="meta objectliteral ts"><span class="meta object member ts"><span class="meta arrow ts"><span>&nbsp;</span></span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="meta var expr ts"><span class="meta objectliteral ts"><span class="meta object member ts"><span class="meta arrow ts"><span>&nbsp;&nbsp;return&nbsp;effect;</span></span></span></span></span></span></span></span></div><div class="line"><span class="source ts"><span class="meta function ts"><span class="meta block ts"><span class="meta var expr ts"><span class="meta objectliteral ts"><span class="meta object member ts"><span class="meta arrow ts"><span>}</span></span></span></span></span></span></span></span></div></pre>
<ul>
<li><code>tag</code>  - 효과의 동작을 지시하는 이진수입니다 (곧 자세히 설명 할 것입니다).</li>
<li><code>create</code>  - painting 이후에 실행해야하는 콜백입니다.</li>
<li><code>destroy</code>  - 초기 렌더링 전에 실행되어야하는<code>create ()</code>에서 반환 된 콜백.</li>
<li><code>inputs</code>  - effect를 파괴하고 재생성 해야하는지 여부를 결정하는 값 집합입니다.</li>
<li><code>next</code>  - Component에서 정의 된 다음 효과에 대한 참조입니다.</li>
</ul>
<p><code>tag</code> 프로퍼티 외에, 다른 프로퍼티는 이해하기 쉽고 간단합니다. 후크를 잘 연구했다면 React가 <code>useMutationEffect()</code> 와 <code>useLayoutEffect()</code>와 같은 몇 가지 특수 효과 후크를 제공한다는 것을 알 수 있습니다. 이 두 가지 효과는 내부적으로 <code>useEffect()</code> 를 사용합니다. 이것은 본질적으로 effect node를 만드는 것을 의미하지만, 다른 태그 값을 사용하여 effect node를 만듭니다.</p>
<p>태그는 이진 값의 조합으로 구성됩니다. (see  <a href="https://github.com/facebook/react/tree/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactHookEffectTags.js?source=post_page---------------------------">implementation</a>):</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>NoEffect</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="comment block js"><span class="punctuation definition comment js"><span>/*</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment js"><span>*/</span></span></span><span>&nbsp;</span><span class="constant numeric binary js"><span>0b00000000</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>UnmountSnapshot</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="comment block js"><span class="punctuation definition comment js"><span>/*</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment js"><span>*/</span></span></span><span>&nbsp;</span><span class="constant numeric binary js"><span>0b00000010</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>UnmountMutation</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="comment block js"><span class="punctuation definition comment js"><span>/*</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment js"><span>*/</span></span></span><span>&nbsp;</span><span class="constant numeric binary js"><span>0b00000100</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>MountMutation</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="comment block js"><span class="punctuation definition comment js"><span>/*</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment js"><span>*/</span></span></span><span>&nbsp;</span><span class="constant numeric binary js"><span>0b00001000</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>UnmountLayout</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="comment block js"><span class="punctuation definition comment js"><span>/*</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment js"><span>*/</span></span></span><span>&nbsp;</span><span class="constant numeric binary js"><span>0b00010000</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>MountLayout</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="comment block js"><span class="punctuation definition comment js"><span>/*</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment js"><span>*/</span></span></span><span>&nbsp;</span><span class="constant numeric binary js"><span>0b00100000</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>MountPassive</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="comment block js"><span class="punctuation definition comment js"><span>/*</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment js"><span>*/</span></span></span><span>&nbsp;</span><span class="constant numeric binary js"><span>0b01000000</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>UnmountPassive</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="comment block js"><span class="punctuation definition comment js"><span>/*</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition comment js"><span>*/</span></span></span><span>&nbsp;</span><span class="constant numeric binary js"><span>0b10000000</span></span><span class="punctuation terminator statement js"><span>;</span></span></span></div></pre>
<p>React에 의해 지원되는 후크 효과 유형.</p>
<p>이 이진 값의 가장 일반적인 경우는 파이프 라인 (<code>|</code>)을 사용하여 비트를 그대로 단일 값에 추가하는 것입니다. 그런 다음 태그가 특정 동작을 구현하는지 여부를 앰퍼샌드 (<code>&#x26;</code>)를 사용하여 확인할 수 있습니다. 결과가 0이 아니면 태그가 지정된 동작을 구현 함을 의미합니다.</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>effectTag</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;MountPassive&nbsp;</span><span class="keyword operator bitwise js"><span>|</span></span><span>&nbsp;UnmountPassive</span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="entity name function js"><span>assert</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>effectTag</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="constant numeric binary js"><span>0b11000000</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span class="meta function-call js"><span class="entity name function js"><span>assert</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span>effectTag&nbsp;</span><span class="keyword operator bitwise js"><span>&amp;</span></span><span>&nbsp;MountPassive</span><span class="meta delimiter object comma js"><span>,</span></span><span>&nbsp;</span><span class="constant numeric binary js"><span>0b10000000</span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div></pre>
<p>React의 바이너리 디자인 패턴을 사용하는 방법을 보여주는 예제.</p>
<p>다음은 React가 해당 태그와 함께 지원하는 후크 효과 유형입니다. (see  <a href="https://github.com/facebook/react/tree/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactFiberHooks.js:520?source=post_page---------------------------">implementation</a>):</p>
<ul>
<li>Default effect —  <code>UnmountPassive | MountPassive</code>.</li>
<li>Mutation effect —  <code>UnmountSnapshot | MountMutation</code>.</li>
<li>Layout effect —  <code>UnmountMutation | MountLayout</code>.</li>
</ul>
<p>행동 구현을 위한 React 검사 방법은 다음과 같습니다. (see  <a href="https://github.com/facebook/react/tree/5f06576f51ece88d846d01abd2ddd575827c6127/packages/react-reconciler/src/ReactFiberCommitWork.js?source=post_page---------------------------#L309">implementation</a>):</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span><span>(</span></span><span class="variable other object js"><span>effect</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>tag</span></span><span>&nbsp;</span><span class="keyword operator bitwise js"><span>&amp;</span></span><span>&nbsp;unmountTag</span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="keyword operator comparison js"><span>!==</span></span><span>&nbsp;NoHookEffect</span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;Unmount</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span class="keyword control js"><span>if</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span><span>(</span></span><span class="variable other object js"><span>effect</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>tag</span></span><span>&nbsp;</span><span class="keyword operator bitwise js"><span>&amp;</span></span><span>&nbsp;mountTag</span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="keyword operator comparison js"><span>!==</span></span><span>&nbsp;NoHookEffect</span><span class="meta brace round js"><span>)</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="comment line double-slash js"><span class="punctuation definition comment js"><span>//</span></span><span>&nbsp;Mount</span></span></span></div><div class="line"><span class="source js"><span class="meta brace curly js"><span>}</span></span></span></div></pre>
<p>React가 구현 한 실제 스냅 샷.</p>
<p>그래서, 우리가 방금 배운 효과에 따라, 실제로 우리는 특정 fiber에 효과를 외부 적으로 주입 할 수 있습니다 :</p>
<pre class="editor editor-colors"><div class="line"><span class="source js"><span class="meta function js"><span class="storage type function js"><span>function</span></span><span>&nbsp;</span><span class="entity name function js"><span>injectEffect</span></span><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="variable parameter function js"><span>fiber</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>lastEffect</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="variable other object js"><span>fiber</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other object property js"><span>updateQueue</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="variable other property js"><span>lastEffect</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>destroyEffect</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function arrow js"><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="entity name type object console js"><span>console</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="support function console js"><span>log</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>on&nbsp;destroy</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>createEffect</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta function arrow js"><span class="meta parameters js"><span class="punctuation definition parameters begin bracket round js"><span>(</span></span><span class="punctuation definition parameters end bracket round js"><span>)</span></span></span><span>&nbsp;</span><span class="storage type function arrow js"><span>=&gt;</span></span></span><span>&nbsp;</span><span class="punctuation definition function body begin bracket curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="entity name type object console js"><span>console</span></span><span class="meta method-call js"><span class="meta delimiter method period js"><span>.</span></span><span class="support function console js"><span>log</span></span><span class="meta arguments js"><span class="punctuation definition arguments begin bracket round js"><span>(</span></span><span class="string quoted single js"><span class="punctuation definition string begin js"><span>&#39;</span></span><span>on&nbsp;create</span><span class="punctuation definition string end js"><span>&#39;</span></span></span><span class="punctuation definition arguments end bracket round js"><span>)</span></span></span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control js"><span>return</span></span><span>&nbsp;destroy</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>injectedEffect</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace curly js"><span>{</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;tag</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="constant numeric binary js"><span>0b11000000</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;next</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="variable other object js"><span>lastEffect</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="support variable property dom js"><span>next</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;create</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;createEffect</span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;destroy</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;destroyEffect</span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;&nbsp;&nbsp;inputs</span><span class="keyword operator assignment js"><span>:</span></span><span>&nbsp;</span><span class="meta brace square js"><span>[</span></span><span>createEffect</span><span class="meta brace square js"><span>]</span></span><span class="meta delimiter object comma js"><span>,</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="meta brace curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="variable other object js"><span>lastEffect</span></span><span class="meta delimiter property period js"><span>.</span></span><span class="support variable property dom js"><span>next</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;injectedEffect</span></span></div><div class="line"><span class="source js"><span class="punctuation definition function body end bracket curly js"><span>}</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;</span></span></div><div class="line"><span class="source js"><span class="storage type const js"><span>const</span></span><span>&nbsp;</span><span class="constant other js"><span>ParentComponent</span></span><span>&nbsp;</span><span class="keyword operator assignment js"><span>=</span></span><span>&nbsp;</span><span class="meta brace round js"><span>(</span></span></span></div><div class="line"><span class="source js"><span>&nbsp;&nbsp;</span><span class="keyword operator comparison js"><span>&lt;</span></span><span>ChildComponent&nbsp;ref</span><span class="keyword operator assignment js"><span>=</span></span><span class="meta brace curly js"><span>{</span></span><span>injectEffect</span><span class="meta brace curly js"><span>}</span></span><span>&nbsp;</span><span class="keyword operator js"><span>/</span></span><span class="keyword operator comparison js"><span>&gt;</span></span></span></div><div class="line"><span class="source js"><span class="meta brace round js"><span>)</span></span></span></div></pre>
<p>효과 주입의 예.</p></div><hr style="margin-bottom:1.53rem;" data-reactid="9"/><div style="display:flex;margin-bottom:3.825rem;" data-reactid="10"><img src="/ho_blog/static/img_profile.1f79e005.jpeg" alt="Merlin.ho" style="margin-right:0.765rem;margin-bottom:0;width:3.06rem;height:3.06rem;" data-reactid="11"/><p data-reactid="12"><!-- react-text: 13 -->Written by <!-- /react-text --><strong data-reactid="14">Merlin.ho</strong><!-- react-text: 15 --> who lives and works in Pangyo building useful things.<!-- /react-text --><!-- react-text: 16 --> <!-- /react-text --></p></div></div><span style="display:block;clear:both;" data-reactid="17"> </span></div></div><script id="webpack-manifest">/*<![CDATA[*/window.webpackManifest={"231608221292675":"app-908537d1c1604367fc7c.js","99219681209289":"component---node-modules-gatsby-plugin-offline-app-shell-js-5c4c5a0f7af9dc69d6d7.js","107818501498521":"component---src-templates-blog-post-js-ebc7dbd570985ea11c85.js","35783957827783":"component---src-pages-index-js-af26cae2bf0d3ad669db.js","60335399758886":"path----557518bd178906f8d58a.js","210333531512890":"path---offline-plugin-app-shell-fallback-a0e39f21c11f6a62c5ab.js","140444808481594":"path---docker-depolyment-1d84d5df089b51063b2d.js","111898030062913":"path---call-stack-ae217c5d96088f3ccd78.js","105843449635648":"path---experience-monorepo-55189771a12a394870c8.js","74801690423126":"path---hello-d-3-be311a841658b23202c7.js","67469829867878":"path---hello-monad-59e45b33826bee6342ec.js","163121481561693":"path---hello-web-server-50ce4db03e3201a76414.js","240236403038750":"path---maintainable-javascript-event-handling-08483da9a7c1874195de.js","275591574691347":"path---lazy-evaluation-b06a6cf4962e0032b9fb.js","163591510377563":"path---maintainable-javascript-no-null-comparison-cd4e4ae619857122decb.js","78697077285144":"path---maintainable-javascript-user-error-throwing-2f9594d962f6c72f1e44.js","219926873231408":"path---refactoring-complex-refactoring-3bde085886c272fceff0.js","122409595676540":"path---think-high-order-function-58f7199816abbe8ab707.js","174342234436027":"path---hello-middleware-214cfa12d70783762915.js","60702703624353":"path---hello-react-a9cedb7b5ae050b8cc99.js","51191554927023":"path---javascript-basic-1-9a67a2cd34c9412b299b.js","73704410068446":"path---javascript-object-a5446c0327b623ee17b9.js","24443999554804":"path---javascript-prototype-dd176c5979078c57a58c.js","203204203537797":"path---react-hook-8e62e2129fd00f7574c6.js","79996153856445":"path---refactoring-method-cleanup-46236c286e9dee8da3fa.js","257369935370228":"path---refactoring-moving-between-object-9e40449234c2cb6b787d.js","246346007348531":"path---tail-recursion-112d6f6c158ce2ab06a7.js","142221992286439":"path---ui-unit-testing-a749535a7628a8651417.js","59645336058927":"path---hello-flow-3fc3da22e88d7c7d8dc3.js","90837107504198":"path---hello-oop-8753bd908c30244d5ee3.js","231909470762625":"path---refactoring-concise-conditionals-d2ab514478d45d06c674.js","58827738984857":"path---refactoring-organization-data-1-3cae99d84479a08a4086.js","75445273333793":"path---react-fiber-react-fiber-01-de4b57b558db4cda0d1b.js","5023129853458":"path---value-and-reference-6083800bc1607839d93d.js","55049869895717":"path---hello-docker-ed4140b3774cb4143b24.js","160582500480188":"path---hello-webpack-b0122eda8ae66d76c639.js","23603272521549":"path---make-promise-bace773fbd60258945c5.js","45440482069588":"path---react-hook-hood-hook-75a9cdff94a7a74ac6a2.js","234343465206083":"path---sop-and-cors-dns-rebinding-a179c3cb1c4d51b972a0.js","122362222700994":"path---refactoring-5ee2d02ba04bdb575764.js","239272989053013":"path---refactoring-generalization-processing-e71d2e5e4b0e785fd2f5.js","201965495218339":"path---refactoring-organization-data-2-6725e1fa3585396087cf.js","88166365168691":"path---try-catch-6aa406d259f11233f53c.js","177359372373161":"path---webpack-config-d646c3ec578c78b12b66.js","71473981912016":"path---javascript-pattern-648c1f680f29c9828e5a.js","147139475262338":"path---react-fiber-react-fiber-02-fe851ce216ddab3e28a6.js","43779473796627":"path---react-fiber-react-fiber-03-29e733efaa17068c8d71.js","120945912393580":"path---refactoring-simplifying-method-calls-294a8dadb4d3828fd246.js","262138261438389":"path---hello-rxjs-06e09733b04ec2a24971.js","132591256042226":"path---hello-mobx-8a535d9fe290f44459de.js","134631639062865":"path---build-react-bdc86e6d7eed10152aa4.js","142629428675168":"path---index-6b94f13ddd51537933a9.js","114276838955818":"component---src-layouts-index-js-60e98b905b7a1c56256e.js"}/*]]>*/</script><script>
            
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'undefined', 'auto');
      }
      </script><script>/*<![CDATA[*/["/ho_blog/commons-7ef76ddc28e0e340bbc7.js","/ho_blog/app-908537d1c1604367fc7c.js","/ho_blog/path---react-hook-hood-hook-75a9cdff94a7a74ac6a2.js","/ho_blog/component---src-templates-blog-post-js-ebc7dbd570985ea11c85.js","/ho_blog/component---src-layouts-index-js-60e98b905b7a1c56256e.js"].forEach(function(s){document.write('<script src="'+s+'" defer></'+'script>')})/*]]>*/</script></body></html>